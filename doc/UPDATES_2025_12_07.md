# Documentation Updates - December 7, 2025

## Overview

Comprehensive documentation update to reflect the current state of the NHEM system with advanced dual ROI functionality.

## Major Changes

### 1. New Dual ROI System Documentation

**New File**: `doc/code_structure/dual_roi_system.md`
- Complete documentation of the dual ROI system architecture
- Technical implementation details with coordinate transformation algorithms
- Performance characteristics and optimization techniques
- API integration examples and usage patterns
- Error handling and troubleshooting guides

### 2. Enhanced API Endpoints Documentation

**Updated**: `doc/code_structure/api_endpoints.md`
- Added new dual ROI endpoints:
  - `GET /api/roi/dual-frame` - Get both ROI1 and ROI2 data
  - `GET /data/realtime/enhanced` - Enhanced data with dual ROI information
- Updated response models and examples
- Added implementation details for dual ROI functionality

### 3. Frontend Architecture Enhancement

**Updated**: `doc/code_structure/frontend_architecture.md`
- Added comprehensive dual ROI display components
- JavaScript classes for ROI visualization:
  - `DualROIManager` - Handles ROI1 and ROI2 display
  - `EnhancedChartManager` - Chart rendering with dual ROI data
  - `ROIConfigUI` - Interactive ROI configuration interface
- Real-time ROI image processing and status indicators
- Color-coded error handling and user feedback

### 4. Architecture Overview Updates

**Updated**: `doc/code_structure/architecture_overview.md`
- Updated system purpose to emphasize dual ROI coordination
- Modified architecture diagrams to reflect dual ROI processing
- Updated component descriptions and data flow

### 5. Main Documentation Index Updates

**Updated**: `doc/code_structure/README.md`
- Added dual ROI system to documentation index
- Updated architecture descriptions to mention dual ROI functionality
- Enhanced data flow diagrams with dual ROI processing
- Updated performance characteristics with ROI-specific metrics
- Modified Python client architecture to mention dual ROI display

### 6. New Integration Guide

**New File**: `doc/single_task/dual_roi_integration/README.md`
- Comprehensive integration examples for Python, JavaScript, and web platforms
- Real-time monitoring applications with matplotlib and canvas rendering
- Advanced analysis with peak detection and anomaly detection
- Error handling best practices and graceful degradation
- Performance optimization techniques including connection pooling and async processing
- Configuration management examples

## Technical Details Updated

### Dual ROI System Features Documented

1. **Coordinate Transformation**: Screen space to image space mapping algorithms
2. **ROI Extraction**: 50x50 pixel center region extraction from ROI1
3. **Gray Value Calculation**: Histogram-based accurate gray value computation
4. **Error Handling**: Comprehensive fallback mechanisms and error recovery
5. **Performance Optimization**: Intelligent caching and adaptive sizing

### API Integration Patterns

1. **Synchronous Python Client**: Basic dual ROI usage with error handling
2. **Real-time Monitoring**: Advanced matplotlib visualization with live updates
3. **Web Frontend**: JavaScript integration with canvas rendering
4. **Asynchronous Processing**: High-performance async/await patterns
5. **Configuration Management**: Runtime configuration and validation

### Frontend Components

1. **DualROIManager**: Handles both ROI display and status management
2. **Enhanced Chart Manager**: Dual ROI data visualization with legends
3. **ROI Configuration UI**: Interactive ROI setup with real-time preview
4. **Error State Handling**: Color-coded status indicators and user feedback

## File Structure Changes

```
doc/
├── code_structure/
│   ├── README.md                          # Updated with dual ROI references
│   ├── dual_roi_system.md                 # NEW - Complete dual ROI documentation
│   ├── api_endpoints.md                   # Updated with new dual ROI endpoints
│   ├── architecture_overview.md           # Updated for dual ROI system
│   └── frontend_architecture.md           # Updated with dual ROI components
├── single_task/
│   └── dual_roi_integration/
│       └── README.md                       # NEW - Comprehensive integration guide
└── UPDATES_2025_12_07.md                  # NEW - This update summary
```

## System Status

### Current Architecture
- **Backend**: FastAPI with dual ROI processing at 45 FPS main + 4 FPS ROI capture
- **Frontend**: HTML5 SPA with dual ROI canvas visualization at 20 FPS
- **Python Client**: Matplotlib-based GUI with dual ROI monitoring
- **API**: 30+ endpoints including new dual ROI specific endpoints

### Key Performance Metrics
- **Main Processing**: 45 FPS (22.22ms intervals)
- **Dual ROI Capture**: 4 FPS (250ms intervals)
- **WebSocket Broadcasting**: 60 FPS (16.67ms intervals)
- **Frontend Updates**: 20 FPS (50ms intervals)

### Configuration Hierarchy
1. **Backend**: `fem_config.json` → Environment Variables → Code Defaults
2. **Frontend**: `config.json` → Browser Settings → Hardcoded defaults
3. **Python Client**: `http_client_config.json` → Environment Variables → Defaults

## Documentation Quality Improvements

### Enhanced Examples
- Real-world usage patterns with complete working code
- Error handling and troubleshooting scenarios
- Performance optimization techniques
- Best practices for production deployment

### Technical Accuracy
- Updated to reflect current code structure and APIs
- Corrected file names and component references
- Current performance metrics and capabilities
- Updated architecture diagrams and data flow

### User Experience
- Comprehensive integration guides for different platforms
- Step-by-step setup instructions
- Common pitfalls and solutions
- Performance tuning recommendations

## Migration Notes

### For Developers
1. **API Changes**: New dual ROI endpoints available alongside existing ROI endpoints
2. **Frontend Integration**: Enhanced JavaScript classes for dual ROI display
3. **Python Client**: Updated client with dual ROI visualization capabilities

### For Users
1. **Enhanced Monitoring**: Dual ROI provides more precise signal analysis
2. **Better Visualization**: Separate ROI1 and ROI2 displays for improved understanding
3. **Improved Error Handling**: Better error states and fallback mechanisms

### Backward Compatibility
- All existing API endpoints remain functional
- Frontend maintains compatibility with older browser versions
- Python client supports both single and dual ROI modes

## Future Documentation Plans

### Planned Enhancements
1. **API Reference**: Complete API reference documentation with examples
2. **Deployment Guide**: Production deployment and scaling recommendations
3. **Troubleshooting Guide**: Comprehensive problem-solving documentation
4. **Performance Tuning**: Advanced optimization techniques and benchmarks

### Maintenance Schedule
- **Monthly**: Technical accuracy reviews and updates
- **Quarterly**: Architecture documentation refresh
- **As Needed**: API endpoint updates and new feature documentation

## Conclusion

This documentation update brings the NHEM documentation in line with the current dual ROI-capable system. The enhanced documentation provides:

- **Complete Technical Coverage**: From low-level algorithms to high-level architecture
- **Practical Integration Examples**: Ready-to-use code for multiple platforms
- **Comprehensive Troubleshooting**: Common issues and solutions
- **Performance Guidance**: Optimization techniques and best practices

The documentation now accurately reflects the sophisticated dual ROI system while maintaining clarity and usability for developers and users alike.

---

*Last Updated: December 7, 2025*
*Version: 1.0*
*Status: Complete*